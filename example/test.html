<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        p {
            display: block;
        }
    </style>
</head>
<body>
    {{{ names }}}
    <a>

        <div></div>

    </a>
    <lazy-box load-path="./faa" loading-component="{{ loading }}" children="2121"></lazy-box>
    <seller 
        data-each="i in hah2as"
        key="{{hahas[i]}}"
        datas="{{ datas }}" 
        icon="{{ icon }}" 
        hahas="{{ hahas }}"
        msg="{{ datas.toString() }}"
        change-seller="{{ changeSeller.bind(this) }}" 
        change-icon="{{ changeIcon }}"
    >
        <div>{{ names }}</div>
    </seller>
    <show data="{{ tree }}"></show>
    <button onclick="{{ changeTree() }}">chgTree</button>
    <script src="../dist/index.js"></script>
    <script>
        var loading = Dbind.createClass({
            template: 'im loading'
        });
        var LazyBox = Dbind.createClass({
            keepProps: [
                'loadingComponent',
                'loadPath'
            ],
            didMount() {
                setTimeout(() => {
                    this.trackingUpdate({
                        component: Dbind.createClass({
                            template: 'load success'
                        })
                    });
                }, 1000)
            },
            getPropsStr(props) {
                let propsStr = '';
                for(let key in props) {
                    if(this.keepProps.indexOf(key) === -1)
                        propsStr += `${key}="${props[key]}" `;
                }    
                return propsStr;
            },
            data: {
                component: null,
                props: null
            },
            template() {
                const props = this.props;

                const loadingComponent = props.loadingComponent || null;
                const loadPath = props.loadPath;

                this.data.component = loadingComponent;

                let propsStr = this.getPropsStr(props);

                return `<component data-from="component" ${propsStr}></component>`;
            }
        });
        var show = Dbind.createClass({
            template: `
                <div data-if="data">
                    <p>{{ data.name }}</p>
                    <component data-from="show" data="{{ data.children }}"></component>
                </div>
            `
        });
        var button = Dbind.createClass({
            data: {
                world: '<p>hh</p>',
            },
            template: `
                <div data-html>
                    {{ world }}
                </div>
                <button onclick="{{ changeSeller() }}">change Seller</button>
                <button onclick="{{ changeIcon() }}">change Icon</button>
            `
        });
        var Seller = Dbind.createClass({
            data: {
                name: 'lc',
                left: '10px',
                dataComponent: Dbind.createClass({
                    didMount() {
                    },
                    template: `<h1>{{name}}</h1>`
                }), 
                handleName: function(name) {
                    return name + 1121211;
                },
                chgComponent: function() {
                    this.trackingUpdate({
                        dataComponent: null
                    });
                },
                chgName: function() {
                    let now = Date.now()
                    this.trackingUpdate({
                        left: '100px'
                    });
                },
                handleClick(index) {
                    console.log(index)
                }
            },
            initliaze() {
                
            },
            willMount() {
                
            },
            didMount() {
                console.log(this.props.children)
            },
            willUpdate(prev, next) {

            },
            template: `
                <component data-from="children"></component>
                <component data-from="dataComponent" name="{{ [1, 3 ,4] }}"></component>
                <button hahaRi onclick="{{ chgComponent() }}" >1244141</button>
                {{key}}
                <ul ref="ul" style="{{ {
                    background: 'red',
                    marginLeft: left
                } }}">
                    <li data-each="i in datas" onclick="{{ handleClick(i) }}"> 
                        {{ handleName(name).toUpperCase()}} : <span>{{ datas[i] }}</span>{{ icon }} haha: {{ hahas[i > 2 ? 0 : i] }}
                    </li>
                    <input type="text" value="{{ msg.toUpperCase() }}"></input>
                </ul>
                <button onclick="{{ chgName() }}">chgname</button>
                <component 
                    data-from="'btn'" 
                    change-seller="{{ changeSeller }}" 
                    change-icon="{{ changeIcon }}"
                ></component>
            `,
            components: {
                btn: button
            }
        });
        Dbind.registerComponent('seller', Seller);
        Dbind.registerComponent('show', show);
        Dbind.registerComponent('lazy-box', LazyBox);
        Dbind.registerComponent('loading', loading);
        var app = Dbind.watch(document.body, {
            datas: ['100', '200', '300'],
            hahas: ['gege', 'lc', '2121221'],
            names: 'zyayasyfasf',
            icon: '$$',
            tree: {
                name: 'lc', 
                children: {
                    name: 'zy', 
                    children: {
                        name: 'sa',
                        children: {
                            name: 'hashsasa',
                            children: null
                        }
                    }
                } 
            },
            changeTree() {
                var tree = app.data.tree;
                tree.children.children = {name: 'what'};
                while(tree.children) {
                    tree.children = Object.assign({}, tree.children);
                    tree = tree.children;
                }
                app.watcher.trackingUpdate({
                    tree:  Object.assign({}, app.data.tree)
                });
            },
            changeSeller: function() {       
                app.watcher.trackingUpdate({
                    datas: [1, 3, 4, 5, 6, 6,7]
                });
            },
            changeIcon: function() {
                app.watcher.trackingUpdate({
                    datas: [5, 0]
                });
            }
        });
    </script>
</body>
</html>